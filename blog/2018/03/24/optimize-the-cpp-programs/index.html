<!doctype html><html lang="zh-CN"><head><meta charset="utf-8">

<!-- Prefetch -->
<link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin>
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net/">

<!-- Meta -->
<title>&#x4F18;&#x5316; C++ &#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x6CD5; | Memory-copy</title>

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Google fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lobster&amp;display=swap&amp;text=Memory-copy0123456789">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;display=swap">
<link rel="shortcut icon" href="/assets/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/assets/favicon-48x48.png"><link rel="manifest" href="/assets/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#7f9cf5"><meta name="application-name" content="Memory-copy"><link rel="apple-touch-icon" sizes="57x57" href="/assets/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/assets/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Memory-copy"><meta name="msapplication-TileColor" content="#1a202c"><meta name="msapplication-TileImage" content="/assets/mstile-144x144.png"><meta name="msapplication-config" content="/assets/browserconfig.xml"><script defer="defer" src="/build/runtime.4f81b965ee044866d74b.js"></script><script defer="defer" src="/build/app.c495528d022cb4af101d.js"></script><link href="/build/app.c495528d022cb4af101d.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Memory-copy" type="application/atom+xml">
</head><body class="bg-background text-content antialiased scrollbar-dark"><div class="container max-w-3xl mx-auto px-4 flex flex-col min-h-screen"><div class="flex-grow">
<header>
  <nav class="flex py-4 justify-end items-center">
    <a class="ml-5 text-content text-opacity-75 hover:text-accent" href="/about/">About</a><a class="ml-5 text-content text-opacity-75 hover:text-accent" href="/archives/">Archives</a>
    <div class="w-2"></div>
    
      <a class="header-icon-btn rss" title="RSS" href="/atom.xml"></a>
    
      <a class="header-icon-btn github" title="GitHub" target="_blank" rel="noopener" href="https://github.com/andytimes"></a>
    
  </nav>
  <h1 class="flex-shrink-0 font-logo text-white text-5xl leading-none text-right pb-12">
    <a href="/">Memory-copy</a>
  </h1>
</header>
 <main>
  

<article id="post-optimize-the-cpp-programs" class="article-container" itemscope itemtype="https://schema.org/Article">
  <header class="article-header">
    <div class="text-accent leading-none pb-2 text-sm">Mar 24, 2018</div>
    <h1 class="text-2xl lg:text-3xl font-light leading-tight pt-2" itemprop="headline">
      <a class="block hover:text-accent" href="/blog/2018/03/24/optimize-the-cpp-programs/">&#x4F18;&#x5316; C++ &#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x6CD5;</a>
    </h1>
  </header>
  <div class="article-body" itemprop="articleBody">
    <p>C/C++ &#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6027;&#x4F7F;&#x5F97;&#x5B83;&#x4EEC;&#x6210;&#x4E3A;&#x9AD8;&#x6027;&#x80FD;&#x8F6F;&#x4EF6;&#x7684;&#x9996;&#x9009;&#x8BED;&#x8A00;&#xFF0C;&#x7136;&#x800C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5229;&#x7528;&#x597D;&#x5176;&#x8BED;&#x8A00;&#x7279;&#x6027;&#xFF0C;&#x4FBF;&#x4F1A;&#x65E0;&#x6CD5;&#x8FBE;&#x5230;&#x5176;&#x6700;&#x9AD8;&#x6027;&#x80FD;&#x3002;&#x7531;&#x4E8E; CPU &#x548C;&#x5185;&#x5B58;&#x5F80;&#x5F80;&#x6210;&#x4E3A;&#x6027;&#x80FD;&#x74F6;&#x9888;&#xFF0C;&#x4F18;&#x5316;&#x7684;&#x91CD;&#x70B9;&#x4E5F;&#x5728;&#x4E8E;&#x8FD9;&#x4E24;&#x65B9;&#x9762;&#x3002;&#x4E0B;&#x9762;&#x4F1A;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x9488;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x5411;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;</p>
<span id="more"></span>
<p>&#x73B0;&#x4EE3; CPU &#x7531;&#x4E8E;&#x7F13;&#x5B58;&#xFF0C;&#x6D41;&#x6C34;&#x7EBF;&#x548C;&#x67B6;&#x6784;&#x4E4B;&#x7C7B;&#x7684;&#x5347;&#x7EA7;&#xFF0C;&#x6027;&#x80FD;&#x5BF9;&#x6BD4;&#x4ECE;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x6781;&#x5927;&#x7684;&#x63D0;&#x5347;&#x3002;&#x800C;&#x5728;&#x56FE;&#x5F62;&#x548C;&#x89C6;&#x97F3;&#x9891;&#x5904;&#x7406;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x6700;&#x5E7F;&#x6CDB;&#x7684;&#x4FBF;&#x662F; CPU &#x63D0;&#x4F9B;&#x7684; SIMD &#x6280;&#x672F;&#xFF08;Single Instruction Multiple Data&#xFF0C;&#x4E2D;&#x6587;&#xFF1A;&#x5355;&#x6307;&#x4EE4;&#x6D41;&#x591A;&#x6570;&#x636E;&#x6D41;&#xFF09;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528; SIMD&#xFF0C;&#x80FD;&#x591F;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x76F8;&#x5173;&#x8FD0;&#x7B97;&#x7684;&#x6027;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#x5728; Intel CPU &#x7684; SSE &#x6307;&#x4EE4;&#x96C6;&#x4E2D;&#xFF0C;<code>addps </code> &#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x5C06;&#x6253;&#x5305;&#x8FDB; 128&#x4F4D; XMM &#x5BC4;&#x5B58;&#x5668;&#x7684; 4 &#x4E2A;&#x5355;&#x7CBE;&#x5EA6;&#x6D6E;&#x70B9;&#x6570;&#xFF08;32&#x4F4D; float&#xFF09;&#x5E76;&#x884C;&#x76F8;&#x52A0;&#xFF0C;&#x5728; Skylake &#x67B6;&#x6784;&#x4E0A;&#xFF0C;<code>addps</code> &#x4E00;&#x822C;&#x4EC5;&#x9700; 4 &#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#xFF0C;&#x800C;&#x4E14;&#x5176;&#x541E;&#x5410;&#x91CF;&#x4E3A; 0.5&#xFF0C;&#x5373;&#x5728;&#x4E00;&#x4E2A;&#x65F6;&#x949F;&#x5468;&#x671F;&#x53EF;&#x6267;&#x884C;&#x4E24;&#x6B21; <code>addps</code> &#x6307;&#x4EE4;&#x3002;Intel &#x8FD8;&#x63D0;&#x4F9B;&#x4E86; C &#x98CE;&#x683C;&#x7684;&#x5185;&#x90E8;&#x51FD;&#x6570;&#xFF08;Intel intrinsic instructions&#xFF09;&#x6765;&#x4F7F;&#x7528; SIMD&#xFF0C;&#x4ECE;&#x800C;&#x65E0;&#x9700;&#x624B;&#x52A8;&#x4E66;&#x5199;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x3002;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x7F16;&#x8BD1;&#x5668;&#x6709;&#x66F4;&#x5927;&#x7684;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x51FD;&#x6570;&#x7684;&#x7B80;&#x5355;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="language-c">// Please compile with gcc or clang
#include &lt;xmmintrin.h&gt;	// _mm_store_ps(), _mm_add_ps(), _mm_load_ps()
#include &lt;stdio.h&gt;

__attribute__((aligned(16))) float A[] = {1.0f, 1.0f, 2.0f, 2.0f};
__attribute__((aligned(16))) float B[] = {3.0f, 3.0f, 4.0f, 4.0f};
__attribute__((aligned(16))) float C[] = {0.0f, 0.0f, 0.0f, 0.0f};

int main(void)
{
	__m128 a = _mm_load_ps(&amp;A[0]);
	__m128 b = _mm_load_ps(&amp;B[0]);

	__m128 s = _mm_add_ps(a, b);
	_mm_store_ps(&amp;C[0], s);

	printf(&quot;%g %g %g %g\n&quot;,C[0], C[1], C[2], C[3]);
}
</code></pre>
<p>&#x4E0A;&#x9762;&#x4F7F;&#x7528;&#x7684; SSE &#x6307;&#x4EE4;&#x5C55;&#x73B0;&#x51FA;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x5C31;&#x662F;&#x9700;&#x8981;&#x8003;&#x8651;&#x5185;&#x5B58;&#x5BF9;&#x9F50;&#x95EE;&#x9898;&#x3002;&#x5C3D;&#x7BA1;&#x6709;&#x53EF;&#x4EE5;&#x5B58;&#x53D6;&#x672A;&#x5BF9;&#x9F50;&#x5143;&#x7D20;&#x7684;&#x5185;&#x90E8;&#x51FD;&#x6570;&#xFF08;&#x6BD4;&#x5982;&#xFF0C;_mm_loadu_ps(), _mm_storeu_ps()&#xFF09;&#xFF0C;&#x4F46;&#x5BF9;&#x9F50;&#x7684;&#x5185;&#x5B58;&#x8BFB;&#x5199;&#x5F80;&#x5F80;&#x80FD;&#x5E26;&#x6765;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x5185;&#x5B58;&#x5BF9;&#x6027;&#x80FD;&#x5F71;&#x54CD;&#x6709;&#x4E24;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;&#x4E00;&#x662F;&#x52A8;&#x6001;&#x5185;&#x5B58;&#x5206;&#x914D;/&#x91CA;&#x653E;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#xFF1B;&#x4E8C;&#x662F;&#x5185;&#x5B58;&#x7F16;&#x6392;&#x7684;&#x5408;&#x7406;&#x6027;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;C++ &#x63D0;&#x4F9B;&#x4E86; new/delete &#x6765;&#x6267;&#x884C;&#x52A8;&#x6001;&#x5185;&#x5B58;&#x5206;&#x914D;/&#x91CA;&#x653E;&#x3002;&#x7136;&#x800C;&#x7531;&#x4E8E;&#x79CD;&#x79CD;&#x539F;&#x56E0;&#xFF0C;&#x4F7F;&#x7528; new/delete &#x5206;&#x914D;/&#x91CA;&#x653E;&#x5185;&#x5B58;&#x7684;&#x662F;&#x4F4E;&#x6548;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x52A8;&#x6001;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF0C;&#x6216;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x914D;&#x5668;&#x4ECE;&#x9884;&#x5148;&#x5206;&#x914D;&#x597D;&#x7684;&#x5927;&#x5757;&#x5185;&#x5B58;&#x4E2D;&#x5B8C;&#x6210;&#x5206;&#x914D;&#x8BF7;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x5206;&#x914D;/&#x91CA;&#x653E;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x5728;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x5426;&#x8003;&#x8651; CPU &#x5982;&#x4F55;&#x5904;&#x7406;&#x6570;&#x636E;&#x4EE5;&#x53CA;&#x4EE3;&#x7801;&#xFF0C;&#x5BF9;&#x6027;&#x80FD;&#x4F1A;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x6BD4;&#x8D77;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6392;&#x5E03;&#x6210;&#x677E;&#x6563;&#x7684;&#x788E;&#x7247;&#x72B6;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x4EE5;&#x7D27;&#x51D1;&#x8FDE;&#x7EED;&#x7684;&#x65B9;&#x5F0F;&#x6392;&#x5E03;&#xFF0C;&#x5F80;&#x5F80;&#x5904;&#x7406;&#x8D77;&#x6765;&#x4F1A;&#x9AD8;&#x6548;&#x5F97;&#x591A;&#x3002;&#x56E0;&#x4E3A; CPU &#x5728;&#x5904;&#x7406;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F1A;&#x5C3D;&#x53EF;&#x80FD;&#x5730;&#x8BFB;&#x53D6;&#x76F8;&#x5173;&#x6570;&#x636E;&#x8FDB;&#x5165;&#x7F13;&#x5B58;&#xFF0C;&#x4EE3;&#x7801;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x9053;&#x7406;&#x3002;&#x5728;&#x6027;&#x80FD;&#x5173;&#x952E;&#x5904;&#xFF0C;&#x4EE3;&#x7801;&#x5E94;&#x5F53;&#x8DB3;&#x591F;&#x7B80;&#x5355;&#xFF0C;&#x907F;&#x514D;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x4EE5;&#x63D0;&#x9AD8;&#x6307;&#x4EE4;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x63A5;&#x89E6;&#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7684;&#x65F6;&#x95F4;&#x5E76;&#x4E0D;&#x4E45;&#xFF0C;&#x4E0A;&#x9762;&#x6240;&#x8FF0;&#x5185;&#x5BB9;&#x4E5F;&#x8BB8;&#x4E0D;&#x591F;&#x4E25;&#x8C28;&#xFF0C;&#x4F46;&#x53EF;&#x4F9B;&#x521D;&#x6B21;&#x6D89;&#x53CA;&#x6B64;&#x9886;&#x57DF;&#x7684;&#x540C;&#x5B66;&#x53C2;&#x8003;&#x3002;&#x9650;&#x4E8E;&#x7BC7;&#x5E45;&#xFF0C;&#x5185;&#x5B58;&#x8BFB;&#x5199;&#x4F18;&#x5316;&#x8FD9;&#x90E8;&#x5206;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x8FC7;&#x591A;&#x4ECB;&#x7ECD;&#x3002;&#x5E0C;&#x671B;&#x5BF9;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x7406;&#x89E3;&#x66F4;&#x6DF1;&#x5165;&#x540E;&#xFF0C;&#x6709;&#x673A;&#x4F1A;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5199;&#x4E00;&#x4E9B;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#x3002;</p>
<ul>
<li>&#x63A8;&#x8350;&#x9605;&#x8BFB;&#xFF1A;</li>
</ul>
<ol>
<li><a target="_blank" rel="noopener" href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel Intrinsics Guide</a></li>
<li><a target="_blank" rel="noopener" href="http://www.agner.org/optimize/instruction_tables.pdf" title="Lists of instruction latencies, throughputs and micro-operation breakdowns for Intel, AMD
and VIA CPUs">Instruction tables</a></li>
</ol>

  </div>
  
  <footer class="article-footer">
    
      <ul class="list-none flex flex-wrap justify-end">
        <li class="pl-2">
            <a class="text-sm text-accent hover:underline" href="/tags/C/">#C++</a>
          </li><li class="pl-2">
            <a class="text-sm text-accent hover:underline" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">#&#x6027;&#x80FD;&#x4F18;&#x5316;</a>
          </li>
      </ul>
      <meta itemprop="keywords" content=",">
    
  </footer>
  <meta itemprop="datePublished" content="2018-03-24T15:55:50.000Z">
  <meta itemprop="dateModified" content="2022-03-26T20:42:57.382Z">
  <div itemprop="author publisher" itemscope itemtype="https://schema.org/Person">
    <meta itemprop="name" content="Andy Deng">
  </div>
</article>

</main>


</div><div class="flex-shrink-0"><footer class="py-12 text-center">
  &#xA9; 2022 Andy Deng<br>
  Powered by <a class="hover:text-accent hover:underline" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
</footer>
</div></div></body></html>